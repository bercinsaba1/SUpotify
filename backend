import json
import time
import spotipy
from spotipy.oauth2 import SpotifyOAuth
from flask import Flask, request, redirect, session, url_for


TOKEN_INFO = "token_info" 
app = Flask(__name__)
app.config["SESSION_COOKIE_NAME"] = "spotify_cookie"
app.secret_key = "sdfsdf943urÄ±jf0"

client_id = "e3bb122dc61347a6b496d5f15a036a68"
client_secret = "e217a887698a43479bcbcc3698853677"

# scope tanimi 
def create_spotify_outh():
    return SpotifyOAuth(
        client_id=client_id,
        client_secret=client_secret,
        redirect_uri=url_for("redirect_page", _external=True),
        scope="user-read-playback-state user-read-private user-read-email user-follow-read user-top-read",
    )
 
@app.route("/")
def login():
    auth_url = create_spotify_outh().get_authorize_url()
    return redirect(auth_url)



@app.route("/redirect")
def redirect_page():
    session.clear()
    code = request.args.get("code")
    token_info = create_spotify_outh().get_access_token(code)
    session[TOKEN_INFO] = token_info  
    return  "basarili"

app.run(debug=True, port=8080)   
